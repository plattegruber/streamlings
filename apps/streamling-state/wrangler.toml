name = "streamling-state"
main = "src/index.ts"
compatibility_date = "2025-10-23"

[durable_objects]
bindings = [{ name = "STREAMLING_STATE", class_name = "StreamlingState" }]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["StreamlingState"]

[vars]
ALLOWED_ORIGIN = "http://localhost:5173"

# Local dev ports:
[dev]
port = 8787

[observability]
enabled = true

# Preview environment (ephemeral, for CI/CD smoke tests)
[env.preview]
name = "streamling-state-preview"

[env.preview.durable_objects]
bindings = [{ name = "STREAMLING_STATE", class_name = "StreamlingState" }]

[[env.preview.migrations]]
tag = "v1"
new_sqlite_classes = ["StreamlingState"]

[env.preview.vars]
TWITCH_CLIENT_ID = "preview"

# Production environment
[env.prod]
name = "streamling-state-prod"

[env.prod.durable_objects]
bindings = [{ name = "STREAMLING_STATE", class_name = "StreamlingState" }]

[[env.prod.migrations]]
tag = "v1"
new_sqlite_classes = ["StreamlingState"]

[env.prod.vars]
TWITCH_CLIENT_ID = "production"
# Secrets: wrangler secret put TWITCH_CLIENT_SECRET --env prod
